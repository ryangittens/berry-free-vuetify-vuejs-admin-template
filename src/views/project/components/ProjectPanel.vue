<script setup lang="ts">
// Icon Imports
import {
  DeviceFloppyIcon,
  DownloadIcon,
  SquarePlusIcon,
  LineIcon,
  LineDashedIcon,
  XIcon,
  Category2Icon,
  CircuitGroundIcon,
  ArrowBackUpIcon,
  ArrowForwardUpIcon,
  Focus2Icon,
  GridPatternIcon
} from 'vue-tabler-icons';
import { useSvgStore } from '@/stores/svgStore';
import { ref } from 'vue';
import { supabase } from '@/utils/supabaseClient';
import { useHistoryStore } from '@/stores/history';
import { DeleteBlockCommand, DeleteLineCommand, AddBlockCommand } from '@/commands';

import { useSnackbarStore } from '@/stores/snackbar';

const snackbarStore = useSnackbarStore();

const store = useSvgStore();
const historyStore = useHistoryStore();

defineEmits(['openBlockDialog']);
const props = defineProps(['project']);
const project = props.project;
const projectId = project.id;

const error = ref(null);

const setSolidBlackLine = () => {
  store.setLineType('solid');
  store.setLineColor('black');
  store.startDrawing();
};

const setSolidGreenLine = () => {
  store.setLineType('solid');
  store.setLineColor('#11dd01');
  store.startDrawing();
};

const setDashedLine = () => {
  store.setLineType('dashed');
  store.setLineColor('#636363');
  store.startDrawing();
};

const deleteObject = () => {
  if (store.selectedBlock) {
    historyStore.executeCommand(new DeleteBlockCommand(store.selectedBlock, store));
  }
  if (store.selectedLine) {
    historyStore.executeCommand(new DeleteLineCommand(store.selectedLine, store));
  }
};

const isActive = (tool: string) => {
  return store.activeTool === tool;
};

const { addBlock } = store;

const addNewBlock = () => {
  const newBlock = {
    object: 'block',
    id: Date.now(),
    x: 40,
    y: 40,
    width: 80,
    height: 80,
    color: '#f0f0f0',
    content:
      '<svg xmlns="http://www.w3.org/2000/svg" width="80" height="160.2" viewBox="0 0 800 1602">\
  <defs>\
    <style>\
      .cls-1 {\
        fill: none;\
        stroke-width: 17px;\
      }\
      .cls-2 {\
        fill: none;\
        stroke-width: 5px;\
      }\
      .cls-1, .cls-2, .cls-3 {\
        stroke: #000;\
      }\
      .cls-2, .cls-3 {\
        fill-rule: evenodd;\
      }\
      .cls-3 {\
        stroke-width: 1px;\
      }\
    </style>\
  </defs>\
  <rect id="SHELL" class="cls-1" width="800" height="1602"/>\
  <path id="DISCONNECT" class="cls-2" d="M289.572,97.9H797.136V227.757H289.572V97.9Z"/>\
  <path id="PV1" class="cls-2" d="M289.78,47.427H394.067V96.6H289.78V47.427Z"/>\
  <path id="PV2" class="cls-2" d="M394.477,47.427H498.764V96.6H394.477V47.427Z"/>\
  <path id="PV3" class="cls-2" d="M498.111,46.427H602.43V95.6H498.111V46.427Z"/>\
  <path id="PV4" class="cls-2" d="M602.9,47.427H707.22V96.6H602.9V47.427Z"/>\
  <path id="PV4_coNNECTOR" data-name="PV4 coNNECTOR" class="cls-2" d="M602.3,3H707V45.97H602.3V3Z"/>\
  <path id="PV3_CONNECTOR" data-name="PV3 CONNECTOR" class="cls-2" d="M498.545,3H603.273V45.97H498.545V3Z"/>\
  <path id="PV2_CONNECTOR_copy" data-name="PV2 CONNECTOR copy" class="cls-2" d="M393.822,3H498.549V45.97H393.822V3Z"/>\
  <path id="PV1_CONNECTOR_copy_2" data-name="PV1 CONNECTOR copy 2" class="cls-2" d="M289.127,3h104.7V45.97h-104.7V3Z"/>\
  <path id="PV_4_Ellipse_1" data-name="PV 4 Ellipse 1" class="cls-2" d="M654.133,5A19.983,19.983,0,1,1,634.2,24.983,19.961,19.961,0,0,1,654.133,5Z"/>\
  <path id="PV_2_Ellipse_1_copy" data-name="PV 2 Ellipse 1 copy" class="cls-2" d="M446.686,5a19.983,19.983,0,1,1-19.939,19.983A19.961,19.961,0,0,1,446.686,5Z"/>\
  <circle id="PV_3_Ellipse_1_copy_2" data-name="PV 3 Ellipse 1 copy 2" class="cls-1" cx="341.953" cy="24.984" r="19.953"/>\
  <path id="PV_3_Ellipse_1_copy_3" data-name="PV 3 Ellipse 1 copy 3" class="cls-2" d="M551.421,5a19.983,19.983,0,1,1-19.953,19.983A19.968,19.968,0,0,1,551.421,5Z"/>\
  <path id="PV3_CONNECTOR_copy" data-name="PV3 CONNECTOR copy" class="cls-2" d="M755.84,876.567h42.881v60.965H755.84V876.567Z"/>\
  <circle id="PV_3_Ellipse_1_copy_4" data-name="PV 3 Ellipse 1 copy 4" class="cls-1" cx="775.782" cy="907.546" r="19.938"/>\
  <path id="PV3_CONNECTOR_copy_2" data-name="PV3 CONNECTOR copy 2" class="cls-2" d="M755.84,1007.51h42.881v60.96H755.84v-60.96Z"/>\
  <circle id="PV_3_Ellipse_1_copy_5" data-name="PV 3 Ellipse 1 copy 5" class="cls-1" cx="776.782" cy="1038.5" r="19.938"/>\
  <path id="PV3_CONNECTOR_copy_3" data-name="PV3 CONNECTOR copy 3" class="cls-2" d="M755.84,1138.45h42.881v60.94H755.84v-60.94Z"/>\
  <circle id="PV_3_Ellipse_1_copy_6" data-name="PV 3 Ellipse 1 copy 6" class="cls-1" cx="776.782" cy="1168.44" r="19.938"/>\
  <path id="LOAD" class="cls-2" d="M550.366,876.567h205.45v60.965H550.366V876.567Z"/>\
  <path id="GEN" class="cls-2" d="M550.366,1007.51h205.45v60.96H550.366v-60.96Z"/>\
  <path id="GRID" class="cls-2" d="M550.366,1138.45h205.45v60.94H550.366v-60.94Z"/>\
  <path id="LOAD-2" data-name="LOAD" class="cls-3" d="M622.905,919.18a1.622,1.622,0,0,0-.15-0.519,0.826,0.826,0,0,0-.253-0.3,0.613,0.613,0,0,0-.357-0.1h-10.69V892.419a0.574,0.574,0,0,0-.092-0.323,0.62,0.62,0,0,0-.323-0.219,3.5,3.5,0,0,0-.61-0.139,7.953,7.953,0,0,0-1.9,0,3.522,3.522,0,0,0-.622.139,0.617,0.617,0,0,0-.322.219,0.567,0.567,0,0,0-.092.323v27.662a1.484,1.484,0,0,0,.472,1.258,1.628,1.628,0,0,0,1,.358h13.178a0.606,0.606,0,0,0,.357-0.1,0.791,0.791,0,0,0,.253-0.323,1.9,1.9,0,0,0,.15-0.531,5.526,5.526,0,0,0,.046-0.773A5.813,5.813,0,0,0,622.905,919.18Zm27.564-19.2a12.31,12.31,0,0,0-2.419-4.71,10.385,10.385,0,0,0-4.066-2.9,16.916,16.916,0,0,0-11.7.1,11.328,11.328,0,0,0-4.262,3.117,13.363,13.363,0,0,0-2.557,4.907,22.63,22.63,0,0,0-.852,6.419,24.659,24.659,0,0,0,.783,6.534,12.486,12.486,0,0,0,2.384,4.757,10.239,10.239,0,0,0,4.055,2.921,15.32,15.32,0,0,0,5.817,1,15.046,15.046,0,0,0,5.967-1.1,11.118,11.118,0,0,0,4.25-3.14,13.689,13.689,0,0,0,2.546-4.953,23.225,23.225,0,0,0,.852-6.534A23.644,23.644,0,0,0,650.469,899.981Zm-3.858,11.3a11.12,11.12,0,0,1-1.541,3.821,7.871,7.871,0,0,1-2.853,2.621,9.016,9.016,0,0,1-4.372.97,9.529,9.529,0,0,1-4.36-.889,7.07,7.07,0,0,1-2.773-2.494,10.874,10.874,0,0,1-1.473-3.821,25.13,25.13,0,0,1-.437-4.849,21.173,21.173,0,0,1,.472-4.537,10.775,10.775,0,0,1,1.565-3.776,8.142,8.142,0,0,1,2.841-2.586,8.825,8.825,0,0,1,4.326-.969,9.378,9.378,0,0,1,4.325.9,7.224,7.224,0,0,1,2.8,2.5,10.861,10.861,0,0,1,1.5,3.787,23.385,23.385,0,0,1,.449,4.722A22.1,22.1,0,0,1,646.611,911.284Zm22.715-18.749a1.237,1.237,0,0,0-.254-0.427,1.026,1.026,0,0,0-.46-0.266,3.645,3.645,0,0,0-.784-0.127q-0.483-.035-1.221-0.034c-0.46,0-.841.011-1.14,0.034a3.319,3.319,0,0,0-.737.127,1.007,1.007,0,0,0-.438.254,1.208,1.208,0,0,0-.242.416l-10,27.754a2.833,2.833,0,0,0-.2.819,0.586,0.586,0,0,0,.161.474,1.1,1.1,0,0,0,.6.219,8.516,8.516,0,0,0,1.094.058,9.8,9.8,0,0,0,1.049-.046,2.06,2.06,0,0,0,.622-0.15,0.911,0.911,0,0,0,.334-0.254,1.233,1.233,0,0,0,.184-0.358l2.442-7.181h12.394l2.557,7.273a1.8,1.8,0,0,0,.2.346,0.684,0.684,0,0,0,.323.22,2.613,2.613,0,0,0,.645.115q0.426,0.034,1.14.035a11.367,11.367,0,0,0,1.141-.046,1.109,1.109,0,0,0,.61-0.208,0.569,0.569,0,0,0,.173-0.474,2.874,2.874,0,0,0-.2-0.819Zm2.373,18.148H661.332l5.137-14.892h0.023ZM706.29,900.27a12.339,12.339,0,0,0-2.742-4.56,11.914,11.914,0,0,0-4.481-2.886,18.672,18.672,0,0,0-6.542-1h-6.75a1.632,1.632,0,0,0-1,.358,1.486,1.486,0,0,0-.473,1.258v26.646a1.484,1.484,0,0,0,.473,1.258,1.626,1.626,0,0,0,1,.358h6.312a20.416,20.416,0,0,0,6.589-.946,11.938,11.938,0,0,0,4.665-2.852,12.308,12.308,0,0,0,2.891-4.8,20.968,20.968,0,0,0,.991-6.776A18.324,18.324,0,0,0,706.29,900.27ZM702.4,911.757a9.54,9.54,0,0,1-1.969,3.706,7.951,7.951,0,0,1-3.272,2.194,14.12,14.12,0,0,1-4.815.715h-4.077V895.121h4.031a12.734,12.734,0,0,1,5.046.854,8.682,8.682,0,0,1,3.236,2.379,9.694,9.694,0,0,1,1.878,3.613,16.335,16.335,0,0,1,.6,4.514A18.767,18.767,0,0,1,702.4,911.757Z"/>\
  <path id="GEN-2" data-name="GEN" class="cls-3" d="M629.77,1025.69a1.611,1.611,0,0,0-.415-0.69,6.162,6.162,0,0,0-1.094-.78,11.186,11.186,0,0,0-1.958-.88,22,22,0,0,0-2.661-.7,16.3,16.3,0,0,0-3.2-.3,15.729,15.729,0,0,0-6.048,1.12,13.561,13.561,0,0,0-4.676,3.15,14.187,14.187,0,0,0-3.018,4.92,19.873,19.873,0,0,0-.081,12.63,13.416,13.416,0,0,0,2.868,4.76,12.7,12.7,0,0,0,4.6,3.06,16.822,16.822,0,0,0,6.174,1.07,19.758,19.758,0,0,0,4.562-.55,21.821,21.821,0,0,0,2.189-.67c0.706-.27,1.282-0.51,1.727-0.73a1.762,1.762,0,0,0,.876-0.78,2.366,2.366,0,0,0,.207-1.03V1037.9a2.244,2.244,0,0,0-.115-0.74,1.186,1.186,0,0,0-.323-0.5,1.3,1.3,0,0,0-.46-0.28,1.511,1.511,0,0,0-.507-0.09h-9.469a0.619,0.619,0,0,0-.345.09,0.768,0.768,0,0,0-.242.29,1.593,1.593,0,0,0-.15.51,5.036,5.036,0,0,0-.046.75,2.862,2.862,0,0,0,.2,1.22,0.626,0.626,0,0,0,.587.39h6.912v8.71a10.6,10.6,0,0,1-2.638,1,12.335,12.335,0,0,1-2.8.34,11.392,11.392,0,0,1-4.274-.79,9.075,9.075,0,0,1-3.352-2.31,10.751,10.751,0,0,1-2.2-3.74,16.269,16.269,0,0,1-.069-9.83,11.092,11.092,0,0,1,2.085-3.79,9.7,9.7,0,0,1,3.317-2.5,10.477,10.477,0,0,1,4.424-.9,13.01,13.01,0,0,1,3.582.44,17.392,17.392,0,0,1,2.592.97,16,16,0,0,1,1.728.97,2,2,0,0,0,.921.44,0.543,0.543,0,0,0,.3-0.09,0.7,0.7,0,0,0,.23-0.31,2.287,2.287,0,0,0,.138-0.56,5.63,5.63,0,0,0,.046-0.77A4.233,4.233,0,0,0,629.77,1025.69Zm24.028,24.53a1.405,1.405,0,0,0-.161-0.51,0.9,0.9,0,0,0-.265-0.29,0.636,0.636,0,0,0-.334-0.09H641.22v-10.69h10a0.738,0.738,0,0,0,.334-0.08,0.637,0.637,0,0,0,.254-0.26,1.542,1.542,0,0,0,.149-0.49,4.79,4.79,0,0,0,.046-0.72,5.476,5.476,0,0,0-.046-0.76,1.6,1.6,0,0,0-.149-0.51,0.863,0.863,0,0,0-.254-0.28,0.573,0.573,0,0,0-.334-0.11h-10v-9.37h11.657a0.636,0.636,0,0,0,.334-0.09,0.715,0.715,0,0,0,.242-0.29,2.144,2.144,0,0,0,.15-0.51,4.113,4.113,0,0,0,.057-0.73,4.358,4.358,0,0,0-.057-0.77,2.4,2.4,0,0,0-.15-0.52,0.591,0.591,0,0,0-.576-0.39H638.732a1.672,1.672,0,0,0-1,.35,1.491,1.491,0,0,0-.473,1.26v26.65a1.491,1.491,0,0,0,.473,1.26,1.672,1.672,0,0,0,1,.35h14.306a0.636,0.636,0,0,0,.334-0.09,0.769,0.769,0,0,0,.265-0.3,1.532,1.532,0,0,0,.161-0.52,5.028,5.028,0,0,0,.046-0.73A5.429,5.429,0,0,0,653.8,1050.22Zm29.028-26.79a0.507,0.507,0,0,0-.1-0.3,0.749,0.749,0,0,0-.316-0.25,1.975,1.975,0,0,0-.608-0.15,8.313,8.313,0,0,0-.924-0.04,8.841,8.841,0,0,0-.985.04,2.1,2.1,0,0,0-.608.15,0.728,0.728,0,0,0-.327.25,0.5,0.5,0,0,0-.1.3v16.2c0,1.22,0,2.49.012,3.8s0.026,2.59.057,3.8h-0.023q-0.534-1.08-1.079-2.16c-0.364-.71-0.732-1.44-1.1-2.18s-0.757-1.49-1.157-2.25-0.817-1.54-1.247-2.34l-6.991-13.12a10.13,10.13,0,0,0-.724-1.19,3.491,3.491,0,0,0-.713-0.74,2.6,2.6,0,0,0-.833-0.38,4.735,4.735,0,0,0-1.153-.11h-1.95a1.869,1.869,0,0,0-1.141.39,1.532,1.532,0,0,0-.523,1.31v27.57a0.584,0.584,0,0,0,.1.32,0.647,0.647,0,0,0,.316.23,2.908,2.908,0,0,0,.6.13,7.71,7.71,0,0,0,1.92,0,3.186,3.186,0,0,0,.608-0.13,0.648,0.648,0,0,0,.328-0.23,0.584,0.584,0,0,0,.1-0.32V1034c0-1.14-.007-2.29-0.023-3.44s-0.038-2.29-.069-3.39h0.046c0.416,0.9.866,1.84,1.349,2.8s0.962,1.88,1.437,2.76l9.1,16.99a11.767,11.767,0,0,0,.884,1.48,4.446,4.446,0,0,0,.834.91,2.426,2.426,0,0,0,.882.47,4.363,4.363,0,0,0,1.084.12h1.31a2.214,2.214,0,0,0,.62-0.09,1.538,1.538,0,0,0,.965-0.83,1.84,1.84,0,0,0,.155-0.79v-27.56Z"/>\
  <path id="GRID-2" data-name="GRID" class="cls-3" d="M629.77,1156.62a1.611,1.611,0,0,0-.415-0.69,5.745,5.745,0,0,0-1.094-.77,10.493,10.493,0,0,0-1.958-.88,20.288,20.288,0,0,0-2.661-.7,16.3,16.3,0,0,0-3.2-.3,15.729,15.729,0,0,0-6.048,1.12,13.289,13.289,0,0,0-4.676,3.15,14,14,0,0,0-3.018,4.92,19.873,19.873,0,0,0-.081,12.63,13.373,13.373,0,0,0,2.868,4.75,12.448,12.448,0,0,0,4.6,3.06,16.615,16.615,0,0,0,6.174,1.08,19.6,19.6,0,0,0,2.281-.14,17.762,17.762,0,0,0,2.281-.42,19.5,19.5,0,0,0,2.189-.67,18.192,18.192,0,0,0,1.727-.72,1.858,1.858,0,0,0,.876-0.78,2.412,2.412,0,0,0,.207-1.04v-11.38a2.2,2.2,0,0,0-.115-0.74,1.224,1.224,0,0,0-.323-0.51,1.429,1.429,0,0,0-.46-0.27,1.312,1.312,0,0,0-.507-0.1h-9.469a0.551,0.551,0,0,0-.345.1,0.73,0.73,0,0,0-.242.28,1.593,1.593,0,0,0-.15.51,5.226,5.226,0,0,0-.046.75,2.914,2.914,0,0,0,.2,1.23,0.626,0.626,0,0,0,.587.39h6.912v8.7a10.618,10.618,0,0,1-2.638,1.01,12.315,12.315,0,0,1-2.8.33,11.389,11.389,0,0,1-4.274-.78,9.318,9.318,0,0,1-3.352-2.31,10.844,10.844,0,0,1-2.2-3.74,16.3,16.3,0,0,1-.069-9.84,11.138,11.138,0,0,1,2.085-3.78,9.459,9.459,0,0,1,3.317-2.5,10.477,10.477,0,0,1,4.424-.9,13.01,13.01,0,0,1,3.582.44,16.351,16.351,0,0,1,2.592.97,14.454,14.454,0,0,1,1.728.97,2.115,2.115,0,0,0,.921.44,0.543,0.543,0,0,0,.3-0.09,0.736,0.736,0,0,0,.23-0.32,2.2,2.2,0,0,0,.138-0.55,5.63,5.63,0,0,0,.046-0.77A4.317,4.317,0,0,0,629.77,1156.62Zm27.277,25.83q-0.093-.33-0.415-1.17l-2.672-6.58c-0.308-.75-0.615-1.43-0.922-2.03a10.9,10.9,0,0,0-.979-1.59,6.977,6.977,0,0,0-1.117-1.19,5.806,5.806,0,0,0-1.337-.82,11.572,11.572,0,0,0,2.373-1.13,7.711,7.711,0,0,0,1.82-1.58,6.559,6.559,0,0,0,1.164-2.1,9.161,9.161,0,0,0-.046-5.52,6.671,6.671,0,0,0-1.348-2.28,7.254,7.254,0,0,0-2.223-1.64,11.422,11.422,0,0,0-3.053-.94c-0.4-.05-0.848-0.09-1.347-0.13s-1.126-.06-1.878-0.06h-6.335a1.622,1.622,0,0,0-1,.36,1.491,1.491,0,0,0-.473,1.26v27.66a0.533,0.533,0,0,0,.415.54,3.088,3.088,0,0,0,.61.14,7.654,7.654,0,0,0,1.913,0,2.86,2.86,0,0,0,.6-0.14,0.616,0.616,0,0,0,.322-0.22,0.518,0.518,0,0,0,.1-0.32v-12.72h2.649a6.02,6.02,0,0,1,2.327.4,5.157,5.157,0,0,1,1.682,1.13,7.358,7.358,0,0,1,1.232,1.73c0.346,0.67.68,1.41,1,2.21l2.742,7.04a1.671,1.671,0,0,0,.219.46,0.794,0.794,0,0,0,.357.29,2.086,2.086,0,0,0,.61.15,8.479,8.479,0,0,0,.979.05,10.5,10.5,0,0,0,1.106-.05,2.2,2.2,0,0,0,.645-0.14,0.5,0.5,0,0,0,.3-0.23,0.7,0.7,0,0,0,.069-0.32A2.136,2.136,0,0,0,657.047,1182.45Zm-6.232-18.46a4.168,4.168,0,0,1-1.117,1.61,5.5,5.5,0,0,1-1.9,1.06,8.692,8.692,0,0,1-2.707.38h-3.87v-10.07h3.34c0.784,0,1.417.02,1.9,0.07a7.6,7.6,0,0,1,1.3.23,4.488,4.488,0,0,1,2.627,1.74,5.37,5.37,0,0,1,.783,2.97A5.523,5.523,0,0,1,650.815,1163.99Zm16.023-9.7a0.564,0.564,0,0,0-.092-0.32,0.614,0.614,0,0,0-.323-0.22,4.036,4.036,0,0,0-.611-0.14,6.3,6.3,0,0,0-.956-0.06,5.943,5.943,0,0,0-.91.06,4.515,4.515,0,0,0-.622.14,0.68,0.68,0,0,0-.345.22,0.518,0.518,0,0,0-.1.32v28.68a0.533,0.533,0,0,0,.415.54,3.1,3.1,0,0,0,.622.14,7.551,7.551,0,0,0,1.9,0,3.1,3.1,0,0,0,.611-0.14,0.533,0.533,0,0,0,.415-0.54v-28.68Zm29.914,7.85a12.432,12.432,0,0,0-2.741-4.56,11.983,11.983,0,0,0-4.481-2.88,18.674,18.674,0,0,0-6.543-1.01h-6.75a1.626,1.626,0,0,0-1,.36,1.491,1.491,0,0,0-.472,1.26v26.64a1.491,1.491,0,0,0,.472,1.26,1.626,1.626,0,0,0,1,.36h6.312a20.161,20.161,0,0,0,6.589-.95,11.922,11.922,0,0,0,4.665-2.85,12.311,12.311,0,0,0,2.891-4.8,20.944,20.944,0,0,0,.991-6.78A18.375,18.375,0,0,0,696.752,1162.14Zm-3.893,11.49a9.579,9.579,0,0,1-1.97,3.71,8.01,8.01,0,0,1-3.271,2.19,14.046,14.046,0,0,1-4.815.72h-4.078v-23.26h4.032a12.7,12.7,0,0,1,5.045.86,8.652,8.652,0,0,1,3.237,2.38,9.663,9.663,0,0,1,1.877,3.61,16.284,16.284,0,0,1,.6,4.51A18.772,18.772,0,0,1,692.859,1173.63Z"/>\
  <path id="PV1-2" data-name="PV1" class="cls-3" d="M326.157,58.894a7.7,7.7,0,0,0-1.348-2.459,7.8,7.8,0,0,0-2.131-1.789,8.634,8.634,0,0,0-2.465-.993,17.389,17.389,0,0,0-2.1-.346q-0.888-.081-1.855-0.081h-6.381a1.674,1.674,0,0,0-1.083.392,1.6,1.6,0,0,0-.484,1.316V82.5a0.573,0.573,0,0,0,.092.323,0.613,0.613,0,0,0,.323.219,3.463,3.463,0,0,0,.61.139,7.949,7.949,0,0,0,1.912,0,3.154,3.154,0,0,0,.6-0.139,0.686,0.686,0,0,0,.323-0.219,0.525,0.525,0,0,0,.1-0.323V71.743h3.386a14.533,14.533,0,0,0,4.757-.693,9.425,9.425,0,0,0,3.364-1.963,8.548,8.548,0,0,0,2.108-3.071,10.588,10.588,0,0,0,.737-4.041A9.6,9.6,0,0,0,326.157,58.894Zm-4.112,5.888a5.382,5.382,0,0,1-1.221,1.963,5.6,5.6,0,0,1-1.993,1.281,8.293,8.293,0,0,1-2.984.462h-3.57V56.5h3.663a14,14,0,0,1,2.084.162,5.655,5.655,0,0,1,2.074.762,4.749,4.749,0,0,1,1.682,1.824,6.224,6.224,0,0,1,.679,3.048A7.236,7.236,0,0,1,322.045,64.782Zm32.183-10.125a3.758,3.758,0,0,0,.219-0.82,0.574,0.574,0,0,0-.115-0.473,0.951,0.951,0,0,0-.565-0.219,8.66,8.66,0,0,0-1.128-.058q-0.692,0-1.106.035a2.314,2.314,0,0,0-.645.127,0.616,0.616,0,0,0-.323.254,1.826,1.826,0,0,0-.161.416l-8.317,25.1h-0.023l-8.547-25.145a1.882,1.882,0,0,0-.2-0.381,0.72,0.72,0,0,0-.311-0.242,1.926,1.926,0,0,0-.587-0.127q-0.38-.035-1.025-0.035-0.785,0-1.244.046a1.315,1.315,0,0,0-.668.208,0.534,0.534,0,0,0-.2.473,2.833,2.833,0,0,0,.2.82l9.745,27.754a1.652,1.652,0,0,0,.149.312,0.745,0.745,0,0,0,.219.219,1.214,1.214,0,0,0,.334.15,4.2,4.2,0,0,0,.473.1,5.02,5.02,0,0,0,.656.058c0.254,0.008.549,0.011,0.887,0.011,0.445,0,.818-0.011,1.117-0.035a3.328,3.328,0,0,0,.738-0.127,1.1,1.1,0,0,0,.449-0.254,1.114,1.114,0,0,0,.253-0.416Zm22.335,26.161a1.786,1.786,0,0,0-.161-0.5,0.786,0.786,0,0,0-.265-0.3,0.629,0.629,0,0,0-.346-0.1H370.4V53.664a0.54,0.54,0,0,0-.07-0.266,0.508,0.508,0,0,0-.276-0.208,2.526,2.526,0,0,0-.576-0.127,7.662,7.662,0,0,0-.921-0.046c-0.277,0-.507,0-0.692.012a2.81,2.81,0,0,0-.483.058c-0.139.031-.254,0.062-0.346,0.092a0.805,0.805,0,0,0-.23.115l-6.866,4.41a1.852,1.852,0,0,0-.334.277,0.992,0.992,0,0,0-.2.323,2.071,2.071,0,0,0-.1.462,5.519,5.519,0,0,0-.035.67,5.428,5.428,0,0,0,.058.877,0.848,0.848,0,0,0,.219.5,0.47,0.47,0,0,0,.426.1,2.586,2.586,0,0,0,.7-0.277l5.759-3.44v22.72h-6.22a0.572,0.572,0,0,0-.334.1,0.834,0.834,0,0,0-.254.3,2.07,2.07,0,0,0-.172.5,3.234,3.234,0,0,0-.069.716,3.357,3.357,0,0,0,.069.739,1.4,1.4,0,0,0,.2.485,0.859,0.859,0,0,0,.264.265,0.584,0.584,0,0,0,.3.081h15.573a0.643,0.643,0,0,0,.311-0.081,0.727,0.727,0,0,0,.265-0.265,1.589,1.589,0,0,0,.185-0.485,3.357,3.357,0,0,0,.069-0.739A3.885,3.885,0,0,0,376.563,80.817Z"/>\
  <path id="PV2-2" data-name="PV2" class="cls-3" d="M429.872,58.894a7.7,7.7,0,0,0-1.348-2.459,7.8,7.8,0,0,0-2.131-1.789,8.622,8.622,0,0,0-2.465-.993,17.389,17.389,0,0,0-2.1-.346q-0.888-.081-1.855-0.081H413.6a1.676,1.676,0,0,0-1.083.392,1.605,1.605,0,0,0-.484,1.316V82.5a0.573,0.573,0,0,0,.092.323,0.617,0.617,0,0,0,.323.219,3.463,3.463,0,0,0,.61.139,7.957,7.957,0,0,0,1.913,0,3.192,3.192,0,0,0,.6-0.139,0.687,0.687,0,0,0,.322-0.219,0.525,0.525,0,0,0,.1-0.323V71.743h3.386a14.543,14.543,0,0,0,4.758-.693,9.429,9.429,0,0,0,3.363-1.963,8.535,8.535,0,0,0,2.108-3.071,10.588,10.588,0,0,0,.737-4.041A9.575,9.575,0,0,0,429.872,58.894Zm-4.112,5.888a5.382,5.382,0,0,1-1.221,1.963,5.6,5.6,0,0,1-1.993,1.281,8.287,8.287,0,0,1-2.983.462h-3.571V56.5h3.663a14.021,14.021,0,0,1,2.085.162,5.657,5.657,0,0,1,2.073.762,4.741,4.741,0,0,1,1.682,1.824,6.213,6.213,0,0,1,.679,3.048A7.236,7.236,0,0,1,425.76,64.782Zm32.183-10.125a3.758,3.758,0,0,0,.219-0.82,0.574,0.574,0,0,0-.115-0.473,0.951,0.951,0,0,0-.564-0.219,8.677,8.677,0,0,0-1.129-.058q-0.692,0-1.106.035a2.322,2.322,0,0,0-.645.127,0.62,0.62,0,0,0-.323.254,1.826,1.826,0,0,0-.161.416l-8.316,25.1h-0.024l-8.546-25.145a1.99,1.99,0,0,0-.2-0.381,0.726,0.726,0,0,0-.311-0.242,1.934,1.934,0,0,0-.588-0.127q-0.379-.035-1.025-0.035-0.783,0-1.244.046a1.319,1.319,0,0,0-.668.208,0.537,0.537,0,0,0-.2.473,2.867,2.867,0,0,0,.2.82l9.745,27.754a1.65,1.65,0,0,0,.15.312,0.73,0.73,0,0,0,.218.219,1.228,1.228,0,0,0,.334.15,4.2,4.2,0,0,0,.473.1,5.02,5.02,0,0,0,.656.058c0.254,0.008.549,0.011,0.887,0.011,0.446,0,.818-0.011,1.118-0.035a3.318,3.318,0,0,0,.737-0.127,1.093,1.093,0,0,0,.449-0.254,1.114,1.114,0,0,0,.253-0.416Zm22.266,26.011a1.528,1.528,0,0,0-.184-0.519,0.9,0.9,0,0,0-.3-0.312,0.689,0.689,0,0,0-.358-0.1H466.4l4.723-4.941a53.746,53.746,0,0,0,4.1-4.653,23.149,23.149,0,0,0,2.361-3.671,11.594,11.594,0,0,0,1.071-3.071,16.194,16.194,0,0,0,.254-2.852,8.46,8.46,0,0,0-.53-3,6.839,6.839,0,0,0-1.6-2.471,7.546,7.546,0,0,0-2.7-1.674,10.732,10.732,0,0,0-3.789-.612,11.781,11.781,0,0,0-2.592.277,15.323,15.323,0,0,0-2.258.681,11.148,11.148,0,0,0-1.7.82,7.634,7.634,0,0,0-.956.658,1.785,1.785,0,0,0-.368.4,1.7,1.7,0,0,0-.15.346,2.075,2.075,0,0,0-.081.439q-0.023.254-.023,0.6a6.166,6.166,0,0,0,.048.831,2.409,2.409,0,0,0,.13.554,0.654,0.654,0,0,0,.214.3,0.5,0.5,0,0,0,.3.092,1.857,1.857,0,0,0,.867-0.392,16.636,16.636,0,0,1,1.45-.854,13.8,13.8,0,0,1,2.021-.854,8.052,8.052,0,0,1,2.6-.392,5.7,5.7,0,0,1,2.187.392,4.506,4.506,0,0,1,1.581,1.062,4.625,4.625,0,0,1,.962,1.559,5.322,5.322,0,0,1,.333,1.882,11.429,11.429,0,0,1-.214,2.124,10.1,10.1,0,0,1-.89,2.517,20.184,20.184,0,0,1-1.923,3.071,38.307,38.307,0,0,1-3.312,3.81l-5.958,6.142a4.429,4.429,0,0,0-.463.566,3.559,3.559,0,0,0-.3.531,2.006,2.006,0,0,0-.154.612,7.929,7.929,0,0,0-.036.808,3.821,3.821,0,0,0,.081.854,1.147,1.147,0,0,0,.253.531,0.993,0.993,0,0,0,.415.265,1.775,1.775,0,0,0,.565.081h16.471a0.7,0.7,0,0,0,.657-0.427,2.152,2.152,0,0,0,.161-0.543,4.28,4.28,0,0,0,.058-0.739A4.08,4.08,0,0,0,480.209,80.667Z"/>\
  <path id="PV3-2" data-name="PV3" class="cls-3" d="M530.6,58.894a7.72,7.72,0,0,0-1.347-2.459,7.8,7.8,0,0,0-2.131-1.789,8.645,8.645,0,0,0-2.465-.993,17.434,17.434,0,0,0-2.1-.346q-0.886-.081-1.854-0.081h-6.382a1.673,1.673,0,0,0-1.082.392,1.6,1.6,0,0,0-.484,1.316V82.5a0.565,0.565,0,0,0,.092.323,0.614,0.614,0,0,0,.322.219,3.477,3.477,0,0,0,.611.139,7.949,7.949,0,0,0,1.912,0,3.173,3.173,0,0,0,.6-0.139,0.691,0.691,0,0,0,.323-0.219,0.524,0.524,0,0,0,.1-0.323V71.743H520.1a14.537,14.537,0,0,0,4.757-.693,9.434,9.434,0,0,0,3.364-1.963,8.533,8.533,0,0,0,2.107-3.071,10.569,10.569,0,0,0,.738-4.041A9.574,9.574,0,0,0,530.6,58.894Zm-4.112,5.888a5.356,5.356,0,0,1-1.221,1.963,5.6,5.6,0,0,1-1.993,1.281,8.287,8.287,0,0,1-2.983.462h-3.571V56.5h3.663a14,14,0,0,1,2.085.162,5.668,5.668,0,0,1,2.074.762,4.739,4.739,0,0,1,1.681,1.824,6.213,6.213,0,0,1,.68,3.048A7.212,7.212,0,0,1,526.483,64.782Zm32.184-10.125a3.758,3.758,0,0,0,.219-0.82,0.574,0.574,0,0,0-.116-0.473,0.948,0.948,0,0,0-.564-0.219,8.667,8.667,0,0,0-1.129-.058c-0.461,0-.829.012-1.106,0.035a2.329,2.329,0,0,0-.645.127A0.617,0.617,0,0,0,555,53.5a1.78,1.78,0,0,0-.161.416l-8.317,25.1H546.5l-8.547-25.145a1.99,1.99,0,0,0-.2-0.381,0.726,0.726,0,0,0-.311-0.242,1.926,1.926,0,0,0-.587-0.127q-0.381-.035-1.026-0.035-0.783,0-1.244.046a1.322,1.322,0,0,0-.668.208,0.536,0.536,0,0,0-.195.473,2.826,2.826,0,0,0,.195.82l9.745,27.754a1.65,1.65,0,0,0,.15.312,0.745,0.745,0,0,0,.219.219,1.2,1.2,0,0,0,.334.15,4.176,4.176,0,0,0,.472.1,5.037,5.037,0,0,0,.657.058q0.38,0.011.887,0.011c0.445,0,.818-0.011,1.117-0.035a3.307,3.307,0,0,0,.737-0.127,1.1,1.1,0,0,0,.45-0.254,1.127,1.127,0,0,0,.253-0.416Zm21.575,17.26a6.7,6.7,0,0,0-1.44-2.159,7.9,7.9,0,0,0-2.2-1.535,8.568,8.568,0,0,0-2.822-.774V67.4a6.587,6.587,0,0,0,5.229-4.653,8.959,8.959,0,0,0,.369-2.621,8.275,8.275,0,0,0-.519-2.99,6.092,6.092,0,0,0-1.566-2.321,7.2,7.2,0,0,0-2.615-1.5,11.347,11.347,0,0,0-3.64-.531,12.986,12.986,0,0,0-2.753.277,13.389,13.389,0,0,0-2.258.681,11.3,11.3,0,0,0-1.647.82,5.6,5.6,0,0,0-.887.635,1.934,1.934,0,0,0-.311.381,2.235,2.235,0,0,0-.161.358,1.878,1.878,0,0,0-.092.462c-0.016.177-.023,0.381-0.023,0.612a7.793,7.793,0,0,0,.034.82,1.589,1.589,0,0,0,.116.485,0.436,0.436,0,0,0,.207.231,0.683,0.683,0,0,0,.288.058,1.856,1.856,0,0,0,.806-0.4,13.732,13.732,0,0,1,1.452-.866,15.773,15.773,0,0,1,1.992-.866,7.174,7.174,0,0,1,2.454-.4,5.992,5.992,0,0,1,2.154.358,4.152,4.152,0,0,1,1.532.981,4.051,4.051,0,0,1,.9,1.466,5.23,5.23,0,0,1,.3,1.766,5.684,5.684,0,0,1-.449,2.3A4.98,4.98,0,0,1,573.4,64.7a5.742,5.742,0,0,1-2.05,1.131,8.815,8.815,0,0,1-2.73.392h-2.6a0.759,0.759,0,0,0-.657.335,1.312,1.312,0,0,0-.2.462,3.2,3.2,0,0,0-.069.727,3.045,3.045,0,0,0,.083.785,1.573,1.573,0,0,0,.215.485,0.764,0.764,0,0,0,.309.266,0.882,0.882,0,0,0,.369.081H569a12.468,12.468,0,0,1,3.272.392,7.149,7.149,0,0,1,2.427,1.131,4.822,4.822,0,0,1,2.01,4.041,5.6,5.6,0,0,1-.4,2.136,4.557,4.557,0,0,1-1.206,1.7,5.594,5.594,0,0,1-1.985,1.108,8.693,8.693,0,0,1-2.741.393,10.747,10.747,0,0,1-2.919-.37,17.842,17.842,0,0,1-2.292-.8,15.093,15.093,0,0,1-1.608-.8,2.278,2.278,0,0,0-.838-0.369,0.514,0.514,0,0,0-.473.323,2.781,2.781,0,0,0-.166,1.154,8.168,8.168,0,0,0,.035.82,3.117,3.117,0,0,0,.1.566,1.845,1.845,0,0,0,.161.392,1.389,1.389,0,0,0,.265.323,4.831,4.831,0,0,0,.841.52,10.659,10.659,0,0,0,1.681.693,17.848,17.848,0,0,0,2.316.577,15.28,15.28,0,0,0,2.8.242,14.315,14.315,0,0,0,4.423-.635A9.2,9.2,0,0,0,578,81.095a7.9,7.9,0,0,0,2.051-2.828,9.244,9.244,0,0,0,.714-3.706A6.774,6.774,0,0,0,580.242,71.916Z"/>\
  <path id="PV4-2" data-name="PV4" class="cls-3" d="M628.327,58.894a7.7,7.7,0,0,0-1.348-2.459,7.788,7.788,0,0,0-2.131-1.789,8.622,8.622,0,0,0-2.465-.993,17.389,17.389,0,0,0-2.1-.346q-0.887-.081-1.855-0.081h-6.381a1.676,1.676,0,0,0-1.083.392,1.605,1.605,0,0,0-.484,1.316V82.5a0.566,0.566,0,0,0,.093.323,0.61,0.61,0,0,0,.322.219,3.456,3.456,0,0,0,.611.139,7.949,7.949,0,0,0,1.912,0,3.173,3.173,0,0,0,.6-0.139,0.687,0.687,0,0,0,.322-0.219,0.525,0.525,0,0,0,.1-0.323V71.743h3.386a14.543,14.543,0,0,0,4.758-.693,9.429,9.429,0,0,0,3.363-1.963,8.535,8.535,0,0,0,2.108-3.071,10.588,10.588,0,0,0,.737-4.041A9.575,9.575,0,0,0,628.327,58.894Zm-4.112,5.888a5.382,5.382,0,0,1-1.221,1.963A5.6,5.6,0,0,1,621,68.026a8.287,8.287,0,0,1-2.983.462h-3.571V56.5h3.663a14,14,0,0,1,2.085.162,5.657,5.657,0,0,1,2.073.762,4.741,4.741,0,0,1,1.682,1.824,6.213,6.213,0,0,1,.68,3.048A7.236,7.236,0,0,1,624.215,64.782ZM656.4,54.657a3.758,3.758,0,0,0,.219-0.82,0.574,0.574,0,0,0-.115-0.473,0.951,0.951,0,0,0-.564-0.219,8.677,8.677,0,0,0-1.129-.058c-0.461,0-.829.012-1.106,0.035a2.322,2.322,0,0,0-.645.127,0.62,0.62,0,0,0-.323.254,1.826,1.826,0,0,0-.161.416l-8.316,25.1h-0.023l-8.547-25.145a1.99,1.99,0,0,0-.2-0.381,0.726,0.726,0,0,0-.311-0.242,1.927,1.927,0,0,0-.588-0.127q-0.379-.035-1.025-0.035-0.783,0-1.244.046a1.319,1.319,0,0,0-.668.208,0.537,0.537,0,0,0-.2.473,2.867,2.867,0,0,0,.2.82L641.4,82.388a1.65,1.65,0,0,0,.15.312,0.722,0.722,0,0,0,.219.219,1.2,1.2,0,0,0,.334.15,4.176,4.176,0,0,0,.472.1,5.02,5.02,0,0,0,.656.058c0.254,0.008.549,0.011,0.887,0.011,0.446,0,.818-0.011,1.118-0.035a3.318,3.318,0,0,0,.737-0.127,1.086,1.086,0,0,0,.449-0.254,1.128,1.128,0,0,0,.254-0.416Zm23.349,18.714a0.72,0.72,0,0,0-.633-0.4H675.75V53.895a0.445,0.445,0,0,0-.188-0.358,1.459,1.459,0,0,0-.54-0.242,6.3,6.3,0,0,0-.928-0.15c-0.383-.038-0.834-0.058-1.35-0.058q-0.705,0-1.222.035a4.766,4.766,0,0,0-.869.127,2.1,2.1,0,0,0-.575.231,1.047,1.047,0,0,0-.341.323L659.111,71.951c-0.106.2-.2,0.389-0.274,0.566a3.326,3.326,0,0,0-.182.554,3.8,3.8,0,0,0-.091.635q-0.022.346-.023,0.785a5.748,5.748,0,0,0,.057.9,1.134,1.134,0,0,0,.205.531,0.786,0.786,0,0,0,.332.254,1.3,1.3,0,0,0,.457.069h12.2v6.281a0.559,0.559,0,0,0,.082.312,0.65,0.65,0,0,0,.309.219,2.423,2.423,0,0,0,.605.139,8.12,8.12,0,0,0,.949.046,8.379,8.379,0,0,0,.973-0.046,2.64,2.64,0,0,0,.617-0.139,0.737,0.737,0,0,0,.332-0.219,0.507,0.507,0,0,0,.1-0.312V76.246h3.364a0.709,0.709,0,0,0,.645-0.439,2.614,2.614,0,0,0,.23-1.2A2.47,2.47,0,0,0,679.747,73.371Zm-7.959-.4h-9.63l9.584-16.394h0.046V72.967Z"/>\
  <path id="DC_DISCONNECT" data-name="DC DISCONNECT" class="cls-3" d="M413.605,156.089a12.35,12.35,0,0,0-2.741-4.56,11.922,11.922,0,0,0-4.481-2.886,18.682,18.682,0,0,0-6.543-1h-6.75a1.636,1.636,0,0,0-1,.358,1.486,1.486,0,0,0-.472,1.259V175.9a1.488,1.488,0,0,0,.472,1.259,1.635,1.635,0,0,0,1,.357H399.4a20.411,20.411,0,0,0,6.589-.946,11.938,11.938,0,0,0,4.665-2.852,12.322,12.322,0,0,0,2.892-4.8,20.969,20.969,0,0,0,.99-6.776A18.324,18.324,0,0,0,413.605,156.089Zm-3.893,11.487a9.555,9.555,0,0,1-1.97,3.706,7.941,7.941,0,0,1-3.271,2.194,14.128,14.128,0,0,1-4.815.715h-4.078V150.94h4.032a12.729,12.729,0,0,1,5.045.854,8.693,8.693,0,0,1,3.237,2.379,9.7,9.7,0,0,1,1.877,3.613,16.3,16.3,0,0,1,.6,4.514A18.806,18.806,0,0,1,409.712,167.576Zm30.8,4.838a2.429,2.429,0,0,0-.1-0.543,0.49,0.49,0,0,0-.186-0.266,0.533,0.533,0,0,0-.278-0.069,1.847,1.847,0,0,0-.949.439,17.894,17.894,0,0,1-1.54.981,12.165,12.165,0,0,1-2.27.982,9.988,9.988,0,0,1-3.115.438,9.109,9.109,0,0,1-3.775-.75,7.351,7.351,0,0,1-2.814-2.217,10.44,10.44,0,0,1-1.76-3.648,20.753,20.753,0,0,1,.023-10.113,11.518,11.518,0,0,1,1.8-3.775,7.645,7.645,0,0,1,2.791-2.344,8.153,8.153,0,0,1,3.625-.8,9.667,9.667,0,0,1,3.138.451,12.135,12.135,0,0,1,2.223.992,14.712,14.712,0,0,1,1.494.993,1.724,1.724,0,0,0,.9.451,0.48,0.48,0,0,0,.313-0.1,0.825,0.825,0,0,0,.22-0.324,2.2,2.2,0,0,0,.139-0.542,5.622,5.622,0,0,0,.047-0.785,6.373,6.373,0,0,0-.035-0.716,3.858,3.858,0,0,0-.092-0.52,1.627,1.627,0,0,0-.15-0.381,2.756,2.756,0,0,0-.4-0.473,6.256,6.256,0,0,0-1.117-.8,10.328,10.328,0,0,0-1.843-.854,16.152,16.152,0,0,0-2.258-.612,12.912,12.912,0,0,0-2.511-.242,13.065,13.065,0,0,0-5.333,1.062,11.475,11.475,0,0,0-4.136,3.082,14.428,14.428,0,0,0-2.684,4.93,23.514,23.514,0,0,0-.069,13.034,13.063,13.063,0,0,0,2.534,4.676,10.581,10.581,0,0,0,3.986,2.863,13.555,13.555,0,0,0,5.241.97,14.421,14.421,0,0,0,3.1-.312,15.272,15.272,0,0,0,2.511-.762,11.629,11.629,0,0,0,1.831-.923,6.666,6.666,0,0,0,.968-0.705,1.987,1.987,0,0,0,.322-0.392,1.616,1.616,0,0,0,.15-0.37,2.735,2.735,0,0,0,.081-0.484q0.023-.278.023-0.647C440.548,172.937,440.536,172.644,440.513,172.414Zm37.943-16.325a12.35,12.35,0,0,0-2.741-4.56,11.922,11.922,0,0,0-4.481-2.886,18.682,18.682,0,0,0-6.543-1h-6.75a1.636,1.636,0,0,0-1,.358,1.486,1.486,0,0,0-.472,1.259V175.9a1.488,1.488,0,0,0,.472,1.259,1.635,1.635,0,0,0,1,.357h6.312a20.411,20.411,0,0,0,6.589-.946,11.938,11.938,0,0,0,4.665-2.852,12.322,12.322,0,0,0,2.892-4.8,20.969,20.969,0,0,0,.99-6.776A18.324,18.324,0,0,0,478.456,156.089Zm-3.893,11.487a9.542,9.542,0,0,1-1.97,3.706,7.941,7.941,0,0,1-3.271,2.194,14.128,14.128,0,0,1-4.815.715h-4.078V150.94h4.032a12.729,12.729,0,0,1,5.045.854,8.693,8.693,0,0,1,3.237,2.379,9.7,9.7,0,0,1,1.877,3.613,16.3,16.3,0,0,1,.6,4.514A18.77,18.77,0,0,1,474.563,167.576Zm14.894-19.337a0.578,0.578,0,0,0-.092-0.324,0.624,0.624,0,0,0-.323-0.219,3.525,3.525,0,0,0-.61-0.139,6.651,6.651,0,0,0-.957-0.057,6.251,6.251,0,0,0-.91.057,3.893,3.893,0,0,0-.622.139,0.692,0.692,0,0,0-.345.219,0.529,0.529,0,0,0-.1.324v28.677a0.572,0.572,0,0,0,.092.323,0.615,0.615,0,0,0,.323.22,3.426,3.426,0,0,0,.622.138,7.817,7.817,0,0,0,1.9,0,3.445,3.445,0,0,0,.61-0.138,0.62,0.62,0,0,0,.323-0.22,0.572,0.572,0,0,0,.092-0.323V148.239ZM512.8,166.052a7.57,7.57,0,0,0-1.543-2.262,10.418,10.418,0,0,0-2.177-1.663q-1.221-.7-2.488-1.293t-2.488-1.166a13.569,13.569,0,0,1-2.177-1.27,5.875,5.875,0,0,1-1.532-1.593,3.89,3.89,0,0,1-.576-2.147,4.373,4.373,0,0,1,.3-1.617,3.53,3.53,0,0,1,.9-1.316,4.456,4.456,0,0,1,1.52-.889,6.343,6.343,0,0,1,2.166-.335,8.061,8.061,0,0,1,2.407.335,11.793,11.793,0,0,1,1.855.739q0.783,0.405,1.324.727a1.853,1.853,0,0,0,.8.324,0.445,0.445,0,0,0,.288-0.1,0.67,0.67,0,0,0,.2-0.323,2.931,2.931,0,0,0,.1-0.543,7.042,7.042,0,0,0,.034-0.739q0-.438-0.023-0.716a3.228,3.228,0,0,0-.069-0.473,1.307,1.307,0,0,0-.115-0.323,1.76,1.76,0,0,0-.288-0.347,4.1,4.1,0,0,0-.91-0.577,10.55,10.55,0,0,0-1.578-.646,13.447,13.447,0,0,0-1.889-.462,11.634,11.634,0,0,0-1.993-.173,12.1,12.1,0,0,0-3.606.519,8.433,8.433,0,0,0-2.879,1.512,6.862,6.862,0,0,0-1.889,2.46,7.829,7.829,0,0,0-.68,3.336,7.577,7.577,0,0,0,.588,3.129,7.836,7.836,0,0,0,1.532,2.274,10.42,10.42,0,0,0,2.142,1.686,26.711,26.711,0,0,0,2.465,1.3q1.267,0.59,2.477,1.155a13.424,13.424,0,0,1,2.154,1.246,5.838,5.838,0,0,1,1.52,1.582,3.944,3.944,0,0,1,.576,2.171,5.07,5.07,0,0,1-.415,2.1,4.23,4.23,0,0,1-1.186,1.558,5.553,5.553,0,0,1-1.843.982,7.668,7.668,0,0,1-2.361.346,10.17,10.17,0,0,1-3.007-.4,14.712,14.712,0,0,1-2.223-.866,14.346,14.346,0,0,1-1.509-.854,1.879,1.879,0,0,0-.91-0.393,0.624,0.624,0,0,0-.322.081,0.594,0.594,0,0,0-.231.289,2.072,2.072,0,0,0-.138.542,6.336,6.336,0,0,0-.046.843,4.133,4.133,0,0,0,.127,1.143,1.687,1.687,0,0,0,.391.7,4.5,4.5,0,0,0,.945.67,10.943,10.943,0,0,0,1.681.762,15.2,15.2,0,0,0,2.281.623,14.287,14.287,0,0,0,2.776.254,13.4,13.4,0,0,0,4-.577,9.288,9.288,0,0,0,3.226-1.72,8.035,8.035,0,0,0,2.142-2.783,8.684,8.684,0,0,0,.772-3.74A7.454,7.454,0,0,0,512.8,166.052Zm26.125,6.362a2.429,2.429,0,0,0-.1-0.543,0.49,0.49,0,0,0-.186-0.266,0.533,0.533,0,0,0-.278-0.069,1.847,1.847,0,0,0-.949.439,17.894,17.894,0,0,1-1.54.981,12.165,12.165,0,0,1-2.27.982,9.988,9.988,0,0,1-3.115.438,9.106,9.106,0,0,1-3.775-.75,7.351,7.351,0,0,1-2.814-2.217,10.44,10.44,0,0,1-1.76-3.648,20.753,20.753,0,0,1,.023-10.113,11.518,11.518,0,0,1,1.795-3.775,7.645,7.645,0,0,1,2.791-2.344,8.153,8.153,0,0,1,3.625-.8,9.667,9.667,0,0,1,3.138.451,12.135,12.135,0,0,1,2.223.992,14.712,14.712,0,0,1,1.494.993,1.724,1.724,0,0,0,.9.451,0.48,0.48,0,0,0,.313-0.1,0.825,0.825,0,0,0,.22-0.324,2.2,2.2,0,0,0,.139-0.542,5.639,5.639,0,0,0,.046-0.785,6.4,6.4,0,0,0-.034-0.716,3.858,3.858,0,0,0-.092-0.52,1.627,1.627,0,0,0-.15-0.381,2.756,2.756,0,0,0-.4-0.473,6.256,6.256,0,0,0-1.117-.8,10.328,10.328,0,0,0-1.843-.854,16.152,16.152,0,0,0-2.258-.612,12.912,12.912,0,0,0-2.511-.242,13.074,13.074,0,0,0-5.334,1.062,11.48,11.48,0,0,0-4.135,3.082,14.411,14.411,0,0,0-2.684,4.93,23.514,23.514,0,0,0-.069,13.034,13.063,13.063,0,0,0,2.534,4.676,10.581,10.581,0,0,0,3.986,2.863,13.555,13.555,0,0,0,5.241.97,14.421,14.421,0,0,0,3.1-.312,15.272,15.272,0,0,0,2.511-.762,11.629,11.629,0,0,0,1.831-.923,6.725,6.725,0,0,0,.968-0.705,1.987,1.987,0,0,0,.322-0.392,1.662,1.662,0,0,0,.15-0.37,2.735,2.735,0,0,0,.081-0.484q0.023-.278.023-0.647C538.965,172.937,538.953,172.644,538.93,172.414ZM567.981,155.8a12.335,12.335,0,0,0-2.419-4.711,10.4,10.4,0,0,0-4.066-2.9,15.2,15.2,0,0,0-5.737-.992,15.046,15.046,0,0,0-5.967,1.1,11.346,11.346,0,0,0-4.262,3.117,13.386,13.386,0,0,0-2.557,4.907,22.63,22.63,0,0,0-.852,6.419,24.659,24.659,0,0,0,.783,6.534,12.486,12.486,0,0,0,2.384,4.757,10.239,10.239,0,0,0,4.055,2.921,15.323,15.323,0,0,0,5.817,1,15.046,15.046,0,0,0,5.967-1.1,11.1,11.1,0,0,0,4.25-3.14,13.673,13.673,0,0,0,2.546-4.953,23.225,23.225,0,0,0,.852-6.534A23.677,23.677,0,0,0,567.981,155.8Zm-3.859,11.3a11.12,11.12,0,0,1-1.541,3.821,7.871,7.871,0,0,1-2.853,2.621,9.016,9.016,0,0,1-4.372.97,9.516,9.516,0,0,1-4.36-.889,7.077,7.077,0,0,1-2.773-2.494,10.854,10.854,0,0,1-1.472-3.821,25.051,25.051,0,0,1-.437-4.849,21.238,21.238,0,0,1,.471-4.537,10.77,10.77,0,0,1,1.565-3.775,8.135,8.135,0,0,1,2.842-2.586,8.808,8.808,0,0,1,4.325-.97,9.385,9.385,0,0,1,4.326.9,7.231,7.231,0,0,1,2.8,2.506,10.865,10.865,0,0,1,1.5,3.786,23.457,23.457,0,0,1,.449,4.722A22.1,22.1,0,0,1,564.122,167.1Zm33.451-18.8a0.51,0.51,0,0,0-.1-0.3,0.782,0.782,0,0,0-.316-0.243,2.026,2.026,0,0,0-.608-0.15,8.14,8.14,0,0,0-.923-0.046,8.6,8.6,0,0,0-.985.046,2.163,2.163,0,0,0-.608.15,0.782,0.782,0,0,0-.328.243,0.509,0.509,0,0,0-.1.3v16.209q0,1.824.012,3.8t0.057,3.8h-0.023q-0.534-1.085-1.08-2.158t-1.1-2.182q-0.557-1.109-1.158-2.252t-1.247-2.343l-6.991-13.115a9.951,9.951,0,0,0-.723-1.189,3.263,3.263,0,0,0-.714-0.739,2.4,2.4,0,0,0-.832-0.381,4.862,4.862,0,0,0-1.153-.116h-1.95a1.858,1.858,0,0,0-1.141.393,1.54,1.54,0,0,0-.523,1.316v27.569a0.564,0.564,0,0,0,.1.312,0.614,0.614,0,0,0,.316.231,3.125,3.125,0,0,0,.595.138,7.982,7.982,0,0,0,1.921,0,3.46,3.46,0,0,0,.608-0.138,0.616,0.616,0,0,0,.328-0.231,0.564,0.564,0,0,0,.1-0.312V158.883q0-1.709-.023-3.44t-0.069-3.4h0.046q0.624,1.363,1.348,2.806t1.438,2.759l9.094,16.994a12.092,12.092,0,0,0,.885,1.478,4.653,4.653,0,0,0,.834.912,2.434,2.434,0,0,0,.882.462,4.157,4.157,0,0,0,1.084.127h1.31a2.148,2.148,0,0,0,.62-0.093,1.536,1.536,0,0,0,.965-0.831,1.807,1.807,0,0,0,.155-0.785V148.308Zm30.455,0a0.509,0.509,0,0,0-.1-0.3,0.789,0.789,0,0,0-.316-0.243,2.026,2.026,0,0,0-.608-0.15,8.146,8.146,0,0,0-.924-0.046,8.6,8.6,0,0,0-.984.046,2.163,2.163,0,0,0-.608.15,0.782,0.782,0,0,0-.328.243,0.509,0.509,0,0,0-.1.3v16.209q0,1.824.011,3.8t0.058,3.8h-0.023q-0.534-1.085-1.08-2.158t-1.1-2.182q-0.557-1.109-1.158-2.252t-1.247-2.343l-6.991-13.115a10.084,10.084,0,0,0-.723-1.189,3.284,3.284,0,0,0-.714-0.739,2.4,2.4,0,0,0-.832-0.381,4.862,4.862,0,0,0-1.153-.116h-1.95a1.862,1.862,0,0,0-1.142.393,1.542,1.542,0,0,0-.523,1.316v27.569a0.565,0.565,0,0,0,.1.312,0.61,0.61,0,0,0,.316.231,3.106,3.106,0,0,0,.6.138,7.982,7.982,0,0,0,1.921,0,3.446,3.446,0,0,0,.607-0.138,0.615,0.615,0,0,0,.329-0.231,0.564,0.564,0,0,0,.1-0.312V158.883q0-1.709-.023-3.44t-0.069-3.4h0.046q0.624,1.363,1.348,2.806t1.438,2.759l9.094,16.994a12.092,12.092,0,0,0,.885,1.478,4.653,4.653,0,0,0,.834.912,2.438,2.438,0,0,0,.881.462,4.165,4.165,0,0,0,1.085.127h1.31a2.136,2.136,0,0,0,.619-0.093,1.535,1.535,0,0,0,.966-0.831,1.822,1.822,0,0,0,.154-0.785V148.308Zm24.466,26.8a1.413,1.413,0,0,0-.161-0.508,0.814,0.814,0,0,0-.265-0.289,0.628,0.628,0,0,0-.334-0.092H639.916V163.524h10a0.691,0.691,0,0,0,.334-0.081,0.658,0.658,0,0,0,.254-0.265,1.455,1.455,0,0,0,.149-0.485,4.761,4.761,0,0,0,.046-0.716,5.446,5.446,0,0,0-.046-0.762,1.492,1.492,0,0,0-.149-0.508,0.867,0.867,0,0,0-.254-0.289,0.574,0.574,0,0,0-.334-0.1h-10V150.94h11.657a0.628,0.628,0,0,0,.334-0.092,0.657,0.657,0,0,0,.242-0.289,2.153,2.153,0,0,0,.15-0.508,4.085,4.085,0,0,0,.057-0.727,4.408,4.408,0,0,0-.057-0.774,2.4,2.4,0,0,0-.15-0.519,0.642,0.642,0,0,0-.242-0.3,0.62,0.62,0,0,0-.334-0.093H637.428a1.632,1.632,0,0,0-1,.358,1.487,1.487,0,0,0-.473,1.259V175.9a1.488,1.488,0,0,0,.473,1.259,1.63,1.63,0,0,0,1,.357h14.306a0.62,0.62,0,0,0,.334-0.092,0.791,0.791,0,0,0,.265-0.3,1.539,1.539,0,0,0,.161-0.52,4.985,4.985,0,0,0,.046-0.727A5.368,5.368,0,0,0,652.494,175.1Zm25.814-2.69a2.429,2.429,0,0,0-.1-0.543,0.49,0.49,0,0,0-.186-0.266,0.533,0.533,0,0,0-.278-0.069,1.847,1.847,0,0,0-.949.439,17.894,17.894,0,0,1-1.54.981,12.165,12.165,0,0,1-2.27.982,9.988,9.988,0,0,1-3.115.438,9.106,9.106,0,0,1-3.775-.75,7.351,7.351,0,0,1-2.814-2.217,10.44,10.44,0,0,1-1.76-3.648,20.753,20.753,0,0,1,.023-10.113,11.518,11.518,0,0,1,1.8-3.775,7.645,7.645,0,0,1,2.791-2.344,8.153,8.153,0,0,1,3.625-.8,9.667,9.667,0,0,1,3.138.451,12.135,12.135,0,0,1,2.223.992,14.712,14.712,0,0,1,1.494.993,1.724,1.724,0,0,0,.9.451,0.48,0.48,0,0,0,.313-0.1,0.825,0.825,0,0,0,.22-0.324,2.2,2.2,0,0,0,.139-0.542,5.639,5.639,0,0,0,.046-0.785,6.4,6.4,0,0,0-.034-0.716,3.858,3.858,0,0,0-.092-0.52,1.627,1.627,0,0,0-.15-0.381,2.756,2.756,0,0,0-.4-0.473,6.273,6.273,0,0,0-1.118-.8,10.263,10.263,0,0,0-1.843-.854,16.1,16.1,0,0,0-2.257-.612,12.912,12.912,0,0,0-2.511-.242,13.074,13.074,0,0,0-5.334,1.062,11.48,11.48,0,0,0-4.135,3.082,14.411,14.411,0,0,0-2.684,4.93,23.514,23.514,0,0,0-.069,13.034,13.063,13.063,0,0,0,2.534,4.676,10.581,10.581,0,0,0,3.986,2.863,13.551,13.551,0,0,0,5.241.97,14.4,14.4,0,0,0,3.1-.312,15.256,15.256,0,0,0,2.512-.762,11.629,11.629,0,0,0,1.831-.923,6.725,6.725,0,0,0,.968-0.705,1.987,1.987,0,0,0,.322-0.392,1.662,1.662,0,0,0,.15-0.37,2.735,2.735,0,0,0,.081-0.484q0.022-.278.023-0.647C678.343,172.937,678.331,172.644,678.308,172.414Zm24.155-23.841a1.773,1.773,0,0,0-.15-0.542,0.7,0.7,0,0,0-.253-0.3,0.62,0.62,0,0,0-.334-0.093H680.992a0.62,0.62,0,0,0-.334.093,0.636,0.636,0,0,0-.242.3,2.287,2.287,0,0,0-.15.542,4.671,4.671,0,0,0-.057.774,4.437,4.437,0,0,0,.057.762,2.059,2.059,0,0,0,.15.519,0.645,0.645,0,0,0,.242.289,0.62,0.62,0,0,0,.334.092h8.386v25.907a0.564,0.564,0,0,0,.092.323,0.612,0.612,0,0,0,.322.22,3.446,3.446,0,0,0,.622.138,7.817,7.817,0,0,0,1.9,0,3.424,3.424,0,0,0,.61-0.138,0.615,0.615,0,0,0,.323-0.22,0.572,0.572,0,0,0,.092-0.323V151.009h8.386a0.62,0.62,0,0,0,.334-0.092,0.719,0.719,0,0,0,.253-0.289,1.607,1.607,0,0,0,.15-0.519,5.426,5.426,0,0,0,.046-0.762A5.712,5.712,0,0,0,702.463,148.573Z"/>\
</svg>\
',
    connectionPoints: [
      { id: 'cp1', x: 40, y: 0 }, // Top-center
      { id: 'cp2', x: 40, y: 80 }, // Bottom-center
      { id: 'cp3', x: 0, y: 40 }, // Left-center
      { id: 'cp4', x: 80, y: 40 } // Right-center
    ]
  };
  historyStore.executeCommand(new AddBlockCommand(newBlock, store));
};

const serializeState = () => {
  return store.serializeState();
};

const svgToDataUrl = (svgElement: any) => {
  return store.svgToDataUrl(svgElement);
};

const undo = () => {
  return historyStore.undo();
};

const redo = () => {
  return historyStore.redo();
};

const centerSvg = () => {
  return store.centerSVG();
};

const fitSVGToExtent = () => {
  return store.fitSVGToExtent();
};

const toggleGrid = () => {
  return store.toggleGrid();
};

const saveDrawing = async () => {
  try {
    const drawing = serializeState();
    const { data, error: updateError } = await supabase.from('projects').update({ drawing }).eq('id', projectId);

    if (updateError) {
      throw updateError;
    }

    snackbarStore.showSnackbar('Drawing Saved Successfully', 'success');
  } catch (err: any) {
    error.value = err.message;
    snackbarStore.showSnackbar('Error Saving Drawing', 'error');
  }
  try {
    const project_svg = svgToDataUrl(store.svg);
    const { data, error: updateError } = await supabase.from('projects').update({ project_svg }).eq('id', projectId);

    if (updateError) {
      throw updateError;
    }
    historyStore.markSaved();
    snackbarStore.showSnackbar('Drawing Saved Successfully', 'success');
  } catch (err: any) {
    error.value = err.message;
    snackbarStore.showSnackbar('Error Saving Drawing', 'error');
  }
};
</script>

<template>
  <v-toolbar elevation="0" height="40" class="mt-n3" style="z-index: 1; background: transparent">
    <v-btn class="text-secondary ml-2" color="background" icon outlined rounded="sm" variant="flat" size="small">
      <DownloadIcon size="17" stroke-width="1.5" />
    </v-btn>
    <v-btn
      @click="saveDrawing"
      class="text-secondary ml-2"
      color="background"
      icon
      outlined
      rounded="sm"
      :disabled="historyStore.saved"
      :variant="historyStore.saved ? 'plain' : 'flat'"
      size="small"
    >
      <DeviceFloppyIcon size="17" stroke-width="1.5" />
    </v-btn>
    <v-btn @click="undo" class="text-secondary ml-2" color="background" icon outlined rounded="sm" variant="flat" size="small">
      <ArrowBackUpIcon size="17" stroke-width="1.5" />
    </v-btn>
    <v-btn @click="redo" class="text-secondary ml-2" color="background" icon outlined rounded="sm" variant="flat" size="small">
      <ArrowForwardUpIcon size="17" stroke-width="1.5" />
    </v-btn>
    <v-btn @click="fitSVGToExtent" class="text-secondary ml-2" color="background" icon outlined rounded="sm" variant="flat" size="small">
      <Focus2Icon size="17" stroke-width="1.5" />
    </v-btn>
    <v-btn @click="toggleGrid" class="text-secondary ml-2" color="background" icon outlined rounded="sm" variant="flat" size="small">
      <GridPatternIcon size="17" stroke-width="1.5" />
    </v-btn>
    <v-spacer />
    <v-btn
      @click="setSolidBlackLine"
      class="text-secondary ml-2"
      color="background"
      icon
      outlined
      rounded="sm"
      :variant="isActive('solid-black') ? 'tonal' : 'flat'"
      size="small"
    >
      <LineIcon style="color: black" size="17" stroke-width="1.5" />
    </v-btn>
    <v-btn
      @click="setSolidGreenLine"
      class="text-secondary ml-2"
      color="background"
      icon
      outlined
      rounded="sm"
      :variant="isActive('solid-#11dd01') ? 'tonal' : 'flat'"
      size="small"
    >
      <CircuitGroundIcon style="color: green" size="17" stroke-width="1.5" />
    </v-btn>
    <v-btn
      @click="setDashedLine"
      class="text-secondary ml-2"
      color="background"
      icon
      outlined
      rounded="sm"
      :variant="isActive('dashed-#636363') ? 'tonal' : 'flat'"
      size="small"
    >
      <LineDashedIcon style="color: black" size="17" stroke-width="1.5" />
    </v-btn>
    <v-btn
      @click="$emit('openBlockDialog')"
      class="text-secondary ml-6"
      color="background"
      icon
      outlined
      rounded="sm"
      variant="flat"
      size="small"
    >
      <Category2Icon size="17" stroke-width="1.5" />
    </v-btn>
    <v-btn @click="addNewBlock" class="text-secondary ml-2" color="background" icon outlined rounded="sm" variant="flat" size="small">
      <SquarePlusIcon size="17" stroke-width="1.5" />
    </v-btn>
  </v-toolbar>
</template>
